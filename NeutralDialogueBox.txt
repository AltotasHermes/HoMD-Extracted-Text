if (BoxMode == "Event")
    if (NearestKinetopede.TypeOfEnemy == "ShiftyCrew")
        if (DialogueScreen == "FirstScreen")
            ("A")
            (" SHIFTY-LOOKING CREW")
            ("They respond only grudgingly to your offer of parley. The captain is taciturn and his crew murmur darkly behind him, their hands a gnat's breath from the holsters at their belts.")
            ("A gang of smugglers? Or mercenaries? Or bandits not in the mood for a fight? You don't know and don't care to ask.")
            ("Attack.", "They clearly aren't expecting a fight.")
                ("Anything for sale?", "Some trades are best conducted in darkness and outside jurisdictions.")
            ("Farewell.", "The captain spits as you turn to leave.")
        else if (DialogueScreen == "SecondScreen" && AttackingShiftyCrew == 1)
            ("A")
            (" SHIFTY-LOOKING CREW")
            ("They are taken aback when your guns swivel in their direction, but react with world-weary discipline.")
            ("Fire.", "")
                StartCombat("Neutral Kinetopede", NearestKinetopede.HullSeed, NearestKinetopede.WillSeed, global.NameArgumentArray, global.CrewNumbersAndAppearanceArray, NearestKinetopede.NumberOfEnemyWeapons, NearestKinetopede.RandomSeed)
        else if (DialogueScreen == "FirstScreen" && NearestKinetopede.FleeFromPlayer == 1)
        else if (DialogueScreen == "SecondScreen" && WasChallengeSuccessful == 1 && Flee == 1)
        else if (DialogueScreen == "SecondScreen" && EnemyFleeing == 1)
        else if (DialogueScreen == "SecondScreen" && PlayerDeath == 1)
        else if (DialogueScreen == "SecondScreen" && EnemyDeath == 1 && oInventories.EnemyVehicleLeftIntact == 0)
            ("V")
            ("ICTORIOUS")
            ("Your artillery tears the enemy kinetopede to ribbons. Plumes of ash and smoke stretch to the ceiling. Time to see if there's anything left to salvage.")
            ("You have won! Sanity recovers slightly.", "Sanity", 1)
            ("You live to fight again.", "Is there anything left to salvage?")
        else if (DialogueScreen == "SecondScreen" && EnemyLoot == 1)
        else if (DialogueScreen == "SecondScreen" && ComparingMaps == 1)
        else if (DialogueScreen == "SecondScreen" && EnemyDeath == 1 && oInventories.EnemyVehicleLeftIntact == 1)
            ("V")
            ("ICTORIOUS")
            ("The enemy kinetopede is battered but intact, its crew dead. You can search for loot at your leisure.")
            ("You have won! Sanity recovers slightly.", "Sanity", 1)
            ("You live to fight again.", "Tear it apart. Take everything there is.")
        else if (DialogueScreen == "SecondScreen" && BlackMarketShiftyCrew == 1)
            ("A")
            (" SHIFTY-LOOKING CREW")
            ("The captain nods. He has things, things which he went to great pains to collect. Probably stolen or scavenged, if you had to guess.")
                ("He shows you a memory-box, which he promises is filled with echoes of joy and delight. He also has several cases of pornography, for which he makes more or less the same claim.")
                NeedsMoney("Buy the Memory-box.", "", "[It costs 120 G.]", 120)
                NeedsMoney("Buy the Obscene Booklets.", "", "[It costs 10 G.]", 10)
                NeedsMoney("Buy the Memory-box and the Obscene Booklets.", "", "[It costs 130 G.]", 130)
                ("He shows you his cases and cases of angelwine. Illegitimately acquired, no doubt. He even - and here he lowers his voice - has acquired a rather rare vintage of the stuff, but he won't let that go cheap.")
                NeedsMoney("Buy some Angelwine.", "", "[It costs 70 G.]", 70)
                NeedsMoney("Buy the '79 Vintage Angelwine.", "", "[It costs 1000 G.]", 1000)
                ("He can offer a stoppered bottle of dreamsalve. (Apply to the underside of your eyelids, he tells you, before sleeping.) Or a slathering of witches' butter. (Ethically harvested, he assures you. The mycena had died of old age. Honest.)")
                NeedsMoney("Buy the Dreamsalve.", "", "[It costs 120 G.]", 120)
                NeedsMoney("Buy the Witches' Butter.", "", "[It costs 80 G.]", 80)
                NeedsMoney("Buy the Dreamsalve and the Witches' Butter.", "", "[It costs 200 G.]", 200)
                ("He can offer you a vial of godsmoke. Fresh from Vex, he claims, and sweet as a summer breeze. Or - for the less discerning customer - he has a bottle of the cheap flesh-rotting necrosia.")
                NeedsMoney("Buy the Godsmoke Vial.", "", "[It costs 50 G.]", 50)
                NeedsMoney("Buy the Necrosia.", "", "[It costs 14 G.]", 14)
                NeedsMoney("Buy both Godsmoke and Necrosia.", "", "[It costs 64 G.]", 64)
            ("Farewell.", "The captain spits as you turn to leave.")
        else if (DialogueScreen == "SecondScreen" && TybaltQuest1 == 1)
    else if (NearestKinetopede.TypeOfEnemy == "PlainSpokenMerchant")
        if (DialogueScreen == "FirstScreen")
            ("A")
            (" PLAIN-SPOKEN MERCHANT")
            ('"' + "Oh, you're one of those maniac explorers from the City of Keys, are you? Hope you have your affairs in order back home." + '"' + " He's just a simple trader. Perhaps a little too plain-spoken for your tastes.")
            ("Attack.", "Merchants are ripe pickings out here.")
                ("Anything for sale?", "He's happy to sell you something out here. It means less tax.")
            ("Farewell.", "The merchant flashes you a parting idiot grin.", "#")
        else if (DialogueScreen == "FirstScreen" && NearestKinetopede.FleeFromPlayer == 1)
        else if (DialogueScreen == "SecondScreen" && WasChallengeSuccessful == 1 && Flee == 1)
        else if (DialogueScreen == "SecondScreen" && EnemyFleeing == 1)
        else if (DialogueScreen == "SecondScreen" && PlayerDeath == 1)
        else if (DialogueScreen == "SecondScreen" && EnemyDeath == 1 && oInventories.EnemyVehicleLeftIntact == 0)
            ("V")
            ("ICTORIOUS")
            ("Your artillery tears the enemy kinetopede to ribbons. Plumes of ash and smoke stretch to the ceiling. Time to see if there's anything left to salvage.")
            ("You have won! Sanity recovers slightly.", "Sanity", 1)
            ("You live to fight again.", "Is there anything left to salvage?")
        else if (DialogueScreen == "SecondScreen" && EnemyLoot == 1)
        else if (DialogueScreen == "SecondScreen" && ComparingMaps == 1)
        else if (DialogueScreen == "SecondScreen" && EnemyDeath == 1 && oInventories.EnemyVehicleLeftIntact == 1)
            ("V")
            ("ICTORIOUS")
            ("The enemy kinetopede is battered but intact, its crew dead. You can search for loot at your leisure.")
            ("You have won! Sanity recovers slightly.", "Sanity", 1)
            ("You live to fight again.", "Tear it apart. Take everything there is.")
        else if (DialogueScreen == "SecondScreen" && Attacking == 1)
            ("A")
            (" PLAIN-SPOKEN MERCHANT")
            ("It would be a foolish merchant indeed who ventured out into darkness unprepared for such difficulties.")
            ("-1 Reputation: The City of Bridges", "Reputation", 5)
            ("Fire.", "")
                StartCombat("Neutral Kinetopede", NearestKinetopede.HullSeed, NearestKinetopede.WillSeed, global.NameArgumentArray, global.CrewNumbersAndAppearanceArray, NearestKinetopede.NumberOfEnemyWeapons, NearestKinetopede.RandomSeed)
        else if (DialogueScreen == "SecondScreen" && BlackMarketShiftyCrew == 1)
            ("A")
            (" PLAIN-SPOKEN MERCHANT")
                ("He has a crate of Fargyle whiskey that he's willing to sell on the cheap.")
                NeedsMoney("Buy the Fargyle Whiskey.", "", "[It costs 50 G.]", 50)
                ("He's carrying hundreds of bolts of silk, and he's sure his suppliers won't miss one.")
                NeedsMoney("Buy some Aranach Silk.", "", "[It costs 65 G.]", 65)
                ("He's carrying a cargo of chillstone, and it's slowing him considerably. He's more than happy to lose some of that weight.")
                NeedsMoney("Buy some Chillstone.", "", "[It costs 120 G.]", 120)
                ("He is carrying expensive Principate oils and perfumes, he says. You'll never smell the like again.")
                NeedsMoney("Buy some Oils & Perfumes.", "", "[It costs 70 G.]", 70)
            ("Farewell.", "The merchant just grins.")
        else if (DialogueScreen == "SecondScreen" && TybaltQuest1 == 1)
    else if (NearestKinetopede.TypeOfEnemy == "ReturningExpedition")
        if (DialogueScreen == "FirstScreen")
            ("A")
            (" RETURNING EXPEDITION")
            ("The crew are ragged remnants, dying or raving. The hull is gouged and scarred. And the captain is a quivering mess in the long slow process of falling apart.")
            ("She was an explorer once, she says, now on her way back from some distant place of which she will not speak.")
            if (NearestKinetopede.ReturningExpeditionStory != "")
                ("There are some things she will speak of, though.", "Let's face it - you're curious.", "#")
            ("Attack.", "They are weak.")
            ("Goodbye.", "Let's hope their luck isn't contagious.", "#")
        else if (DialogueScreen == "SecondScreen" && Attacking == 1)
            ("A")
            (" RETURNING EXPEDITION")
            ("For them, this is just the latest misfortune in a long run of bad luck. They get ready to face you, as they have faced others.")
            ("Fire.", "")
                StartCombat("Neutral Kinetopede", NearestKinetopede.HullSeed, NearestKinetopede.WillSeed, global.NameArgumentArray, global.CrewNumbersAndAppearanceArray, NearestKinetopede.NumberOfEnemyWeapons, NearestKinetopede.RandomSeed)
        else if (DialogueScreen == "FirstScreen" && NearestKinetopede.FleeFromPlayer == 1)
        else if (DialogueScreen == "SecondScreen" && WasChallengeSuccessful == 1 && Flee == 1)
        else if (DialogueScreen == "SecondScreen" && EnemyFleeing == 1)
        else if (DialogueScreen == "SecondScreen" && PlayerDeath == 1)
        else if (DialogueScreen == "SecondScreen" && EnemyDeath == 1 && oInventories.EnemyVehicleLeftIntact == 0)
            ("V")
            ("ICTORIOUS")
            ("Your artillery tears the enemy kinetopede to ribbons. Plumes of ash and smoke stretch to the ceiling. Time to see if there's anything left to salvage.")
            ("You have won! Sanity recovers slightly.", "Sanity", 1)
            ("You live to fight again.", "Is there anything left to salvage?")
        else if (DialogueScreen == "SecondScreen" && EnemyLoot == 1)
        else if (DialogueScreen == "SecondScreen" && ComparingMaps == 1)
        else if (DialogueScreen == "SecondScreen" && EnemyDeath == 1 && oInventories.EnemyVehicleLeftIntact == 1)
            ("V")
            ("ICTORIOUS")
            ("The enemy kinetopede is battered but intact, its crew dead. You can search for loot at your leisure.")
            ("You have won! Sanity recovers slightly.", "Sanity", 1)
            ("You live to fight again.", "Tear it apart. Take everything there is.")
        else if (DialogueScreen == "SecondScreen" && ExpeditionStory == 1)
            ("W")
            ("HISPERS IN THE DARK")
            if (NearestKinetopede.ReturningExpeditionStory == "ReflectionOnMortality")
                ("In a flat, calm voice, she tells you about the crew who lost their lives. The Gunner blown up by bandits. The navigator who walked into darkness of her own accord. The lightbearer infested by suicide-leeches. She is surrounded by their ghosts, she tells you. She can still hear their voices.")
                ("Gained x1 Reflection on Mortality.", "Logbook", 3)
            else if (NearestKinetopede.ReturningExpeditionStory == "LuridTale")
                ("Her voice is cracked. She tells you of blood that's still only half-dried, sticky on the floor. She speaks of old friends turned monstrous. A civil war, fought in cramped corridors with tiny daggers. A mutiny born of madness.")
                ("A mutiny never put down, with culprits never punished. She smiles, and you notice the knife at her belt.")
                ("Gained x1 Lurid Tale.", "Logbook", 3)
            else if (NearestKinetopede.ReturningExpeditionStory == "DivineScrutinyAbjah")
                ("They found emptiness, she says. They found it everywhere. You ask if that's some kind of metaphor. Nothing, she tells you, is as crowded as is nothing.")
                ReligionText("Abjah", 1, 1)
            else if (NearestKinetopede.ReturningExpeditionStory == "Apprehensions")
                ("She won't speak of where she went, or how she came back.")
                ("But she clearly saw something she wasn't meant to see, and struggles to put it into words. 'It is not dead,' she says, shivering. 'Its mind is burned to nothing, but it will not die.'")
            ("The darkness swallows her words.", "Move on, before it swallows you too.")
                if (NearestKinetopede.ReturningExpeditionStory == "ReflectionOnMortality")
                else if (NearestKinetopede.ReturningExpeditionStory == "LuridTale")
                else if (NearestKinetopede.ReturningExpeditionStory == "DivineScrutinyAbjah")
                    ReligionItemAdd("Abjah", 1, 1)
                NearestKinetopede.ReturningExpeditionStory = ""
        else if (DialogueScreen == "SecondScreen" && TybaltQuest1 == 1)
    else if (NearestKinetopede.TypeOfEnemy == "JamPackedBoxcars")
        if (DialogueScreen == "FirstScreen")
            ("J")
            ("AM-PACKED BOXCARS")
            ("Dilapidated boxcars, gouged with craters and scars from some recent peril.")
            ("You see dozens of travellers squashed inside - from the coughing elderly to the squalling infants, they are hopeful and afraid. You wonder what drove them to risk the darkness of the House.")
            ("Attack.", "They have very little, and you intend to take it.")
            ("Farewell.", "You wish the captain safe passage. She smiles bitterly.")
        else if (DialogueScreen == "FirstScreen" && NearestKinetopede.FleeFromPlayer == 1)
        else if (DialogueScreen == "SecondScreen" && WasChallengeSuccessful == 1 && Flee == 1)
        else if (DialogueScreen == "SecondScreen" && EnemyFleeing == 1)
        else if (DialogueScreen == "SecondScreen" && PlayerDeath == 1)
        else if (DialogueScreen == "SecondScreen" && EnemyDeath == 1 && oInventories.EnemyVehicleLeftIntact == 0)
            ("V")
            ("ICTORIOUS")
            ("Your artillery tears the enemy kinetopede to ribbons. Plumes of ash and smoke stretch to the ceiling. Time to see if there's anything left to salvage.")
            ("You have won! Sanity recovers slightly.", "Sanity", 1)
            ("You live to fight again.", "Is there anything left to salvage?")
        else if (DialogueScreen == "SecondScreen" && EnemyLoot == 1)
        else if (DialogueScreen == "SecondScreen" && ComparingMaps == 1)
        else if (DialogueScreen == "SecondScreen" && EnemyDeath == 1 && oInventories.EnemyVehicleLeftIntact == 1)
            ("V")
            ("ICTORIOUS")
            ("The enemy kinetopede is battered but intact, its crew dead. You can search for loot at your leisure.")
            ("You have won! Sanity recovers slightly.", "Sanity", 1)
            ("You live to fight again.", "Tear it apart. Take everything there is.")
        else if (DialogueScreen == "SecondScreen" && Attacking == 1)
            ("J")
            ("AM-PACKED BOXCARS")
            ("Easy prey.")
            ("-1 Reputation: The City of Keys", "Reputation", 5)
            ("Fire.", "")
                StartCombat("Neutral Kinetopede", NearestKinetopede.HullSeed, NearestKinetopede.WillSeed, global.NameArgumentArray, global.CrewNumbersAndAppearanceArray, NearestKinetopede.NumberOfEnemyWeapons, NearestKinetopede.RandomSeed)
        else if (DialogueScreen == "SecondScreen" && TybaltQuest1 == 1)
